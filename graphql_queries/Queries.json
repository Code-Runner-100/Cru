query GetRangeByTopic($start: timestamp!, $end: timestamp!, $topicPrefix: String!) {
  vw_mqtt_parsed(
    where: {
      time: { _gte: $start, _lt: $end }
      topic: { _ilike: $topicPrefix }
    }
    order_by: { time: asc }
    limit: 10
  ) {
    time
    topic
    v_array
  }
}



{
  "start": "2026-01-22 20:20:50",
  "end":   "2026-01-22 20:20:55",
  "topicPrefix": "SEL-Stream-Server-532063/WING D/waveform/%"
}


=============================================

CREATE OR REPLACE VIEW public.vw_mqtt_parsed AS
WITH s AS (
  SELECT time, topic, value::jsonb AS payload
  FROM mqtt_consumer
  WHERE value IS NOT NULL
)
SELECT
  time,
  topic,
  payload,
  (payload ->> 'rate')::int AS rate,
  (payload -> 'timestamps' ->> 0)::timestamptz AS sample_ts,
  (payload -> 'streams' -> 0 ->> 'n') AS stream_name,
  (payload -> 'streams' -> 0 -> 'v') AS v_array
FROM s;
